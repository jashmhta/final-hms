server {
  listen 80;
  server_name _;

  set $base_headers "proxy_set_header Host $host;\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header X-Forwarded-Proto $scheme;\nproxy_set_header Authorization $http_authorization;\nproxy_set_header X-Request-ID $request_id;";

  location /api/patients/ {
    proxy_pass http://patients_service:9000/api/patients/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/appointments/ {
    proxy_pass http://appointments_service:9001/api/appointments/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/billing/ {
    proxy_pass http://billing_service:9002/api/billing/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/pharmacy/ {
    proxy_pass http://pharmacy_service:9003/api/pharmacy/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/lab/ {
    proxy_pass http://lab_service:9004/api/lab/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/hr/ {
    proxy_pass http://hr_service:9005/api/hr/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/facilities/ {
    proxy_pass http://facilities_service:9006/api/facilities/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/estimator/ {
    proxy_pass http://price_estimator_service:9007/api/estimator/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/bed/ {
    proxy_pass http://bed_management_service:9008/api/bed/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/triage/ {
    proxy_pass http://triage_service:9009/api/triage/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/analytics/ {
    proxy_pass http://analytics_service:9010/api/analytics/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/notifications/ {
    proxy_pass http://notifications_service:9011/api/notifications/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/radiology/ {
    proxy_pass http://radiology_service:9012/api/radiology/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/feedback/ {
    proxy_pass http://feedback_service:9013/api/feedback/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/consent/ {
    proxy_pass http://consent_service:9014/api/consent/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/audit/ {
    proxy_pass http://audit_service:9015/api/audit/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/er/ {
    proxy_pass http://er_alerts_service:9016/api/er/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location /api/ot/ {
    proxy_pass http://ot_scheduling_service:9017/api/ot/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  # Prometheus metrics for microservices
  location /metrics/price_estimator {
    proxy_pass http://price_estimator_service:9007/metrics;
  }
  location /metrics/bed {
    proxy_pass http://bed_management_service:9008/metrics;
  }
  location /metrics/triage {
    proxy_pass http://triage_service:9009/metrics;
  }
  location /metrics/hr {
    proxy_pass http://hr_service:9005/metrics;
  }
  location /metrics/analytics {
    proxy_pass http://analytics_service:9010/metrics;
  }
  location /metrics/notifications {
    proxy_pass http://notifications_service:9011/metrics;
  }
  location /metrics/radiology {
    proxy_pass http://radiology_service:9012/metrics;
  }
  location /metrics/feedback {
    proxy_pass http://feedback_service:9013/metrics;
  }
  location /metrics/consent {
    proxy_pass http://consent_service:9014/metrics;
  }
  location /metrics/audit {
    proxy_pass http://audit_service:9015/metrics;
  }
  location /graphql {
    proxy_pass http://graphql_gateway:9020/graphql;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }
  location /metrics/er_alerts {
    proxy_pass http://er_alerts_service:9016/metrics;
  }
  location /metrics/ot_scheduling {
    proxy_pass http://ot_scheduling_service:9017/metrics;
  }

  location /api/ {
    proxy_pass http://backend:8000/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $request_id;
  }

  location / {
    root   /usr/share/nginx/html;
    try_files $uri /index.html;
  }
}