name: CI
true:
  push:
    branches:
    - master
  pull_request:
    branches:
    - master
  workflow_dispatch: null
jobs:
  all:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - name: Reuse npm cache folder
      uses: actions/cache@v2
      env:
        cache-name: cache-node-modules
      with:
        path: '~/.npm

          ./node_modules

          ./test-electron/node_modules

          '
        key: ${{ runner.os }}-npm-${{ env.cache-name }}-${{ hashFiles('**/package.json')
          }}
        restore-keys: '${{ runner.os }}-npm-${{ env.cache-name }}-

          ${{ runner.os }}-npm-

          ${{ runner.os }}-

          '
    - name: install node modules
      run: npm install
    - name: build
      run: npm run build
    - name: check build size webpack
      run: npm run size:webpack
    - name: check build size browserify
      run: npm run size:browserify
    - name: check build size rollup
      run: npm run size:rollup
    - name: code format
      run: npm run lint
    - name: test typings
      run: npm run test:typings
    - name: test node
      run: npm run test:node
    - name: test browser
      uses: GabrielBB/xvfb-action@v1
      with:
        working-directory: ./
        run: npm run test:browser
    - name: test performance
      run: npm run test:performance
    - name: test e2e
      uses: GabrielBB/xvfb-action@v1
      with:
        working-directory: ./
        run: npm run test:e2e
