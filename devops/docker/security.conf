# Security configurations for healthcare compliance

# Block malicious user agents
if ($http_user_agent ~* (bot|crawl|spider|scraper|scanner)) {
    return 403;
}

# Block suspicious request methods
if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|OPTIONS)$) {
    return 405;
}

# Block SQL injection attempts
if ($args ~* "union.*select.*\(") {
    return 403;
}

# Block XSS attempts
if ($args ~* "<script>|javascript:|eval\(") {
    return 403;
}

# Block file inclusion attempts
if ($args ~* "\.\./") {
    return 403;
}

# Block direct access to sensitive files
location ~* \.(env|key|pem|crt|csr|p12|pfx)$ {
    deny all;
    return 403;
}

# Limit request size
client_max_body_size 10M;
client_body_buffer_size 128k;

# Timeout settings
client_body_timeout 10s;
client_header_timeout 10s;
send_timeout 10s;

# Connection limits
limit_conn server 100;
limit_conn per_ip 10;

# Block bad bots
if ($http_user_agent ~* (SemrushBot|AhrefsBot|MJ12bot|DotBot|Baiduspider)) {
    return 403;
}

# Security for API endpoints
location ~* ^/api/(admin|users|patients)/.* {
    # Additional security for sensitive endpoints
    limit_req zone=api burst=5 nodelay;
    limit_req zone=login burst=2 nodelay;
}