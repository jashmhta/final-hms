Creating test database for alias 'default' ('file:memorydb_default?mode=memory&cache=shared')...
Found 3 test(s).
Operations to perform:
  Synchronize unmigrated apps: corsheaders, django_filters, django_prometheus, drf_spectacular, messages, rest_framework, rest_framework_simplejwt, staticfiles
  Apply all migrations: accounting, admin, appointments, auth, billing, contenttypes, core, ehr, facilities, feedback, hospitals, hr, lab, patients, pharmacy, sessions, users
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
Running migrations:
  Applying hospitals.0001_initial... OK
  Applying contenttypes.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0001_initial... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying auth.0012_alter_user_first_name_max_length... OK
  Applying users.0001_initial... OK
  Applying patients.0001_initial... OK
  Applying patients.0002_alter_patient_email_alter_patient_phone... OK
  Applying hospitals.0002_plan_hospitalplan... OK
  Applying appointments.0001_initial... OK
  Applying billing.0001_initial... OK
  Applying billing.0002_servicecatalog... OK
  Applying billing.0003_bill_discount_cents_bill_net_cents_and_more... OK
  Applying billing.0004_departmentbudget... OK
  Applying billing.0005_indexes... OK
  Applying billing.0006_remove_bill_bill_status_idx_and_more... OK
  Applying accounting.0001_initial... OK
  Applying accounting.0002_alter_accountingauditlog_user... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying patients.0003_emergencycontact_insuranceinformation_patientalert_and_more... OK
  Applying appointments.0002_appointmenthistory_appointmentreminder_and_more... OK
  Applying appointments.0003_alter_appointment_appointment_number... OK
  Applying core.0001_initial... OK
  Applying ehr.0001_initial... OK
  Applying ehr.0002_encounterattachment... OK
  Applying ehr.0003_allergy_assessment_clinicalnote_planofcare_and_more... OK
  Applying ehr.0004_alter_encounter_encounter_number... OK
  Applying facilities.0001_initial... OK
  Applying feedback.0001_initial... OK
  Applying hr.0001_initial... OK
  Applying lab.0001_initial... OK
  Applying patients.0004_alter_patient_medical_record_number... OK
  Applying pharmacy.0001_initial... OK
  Applying sessions.0001_initial... OK
  Applying users.0002_department_usercredential_userloginhistory_and_more... OK
System check identified no issues (0 silenced).
backend.accounting.tests (unittest.loader._FailedTest.backend.accounting.tests) ... ERROR
test_slots (backend.appointments.tests.AvailableSlotsTest.test_slots) ... ERROR
test_low_stock (backend.pharmacy.tests.LowStockTest.test_low_stock) ... [WARNING] 2025-09-12 02:29:29,579 django.request Forbidden: /api/medications/low_stock/
FAIL

======================================================================
ERROR: backend.accounting.tests (unittest.loader._FailedTest.backend.accounting.tests)
----------------------------------------------------------------------
ImportError: Failed to import test module: backend.accounting.tests
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/loader.py", line 394, in _find_test_path
    module = self._get_module_from_name(name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/loader.py", line 337, in _get_module_from_name
    __import__(name)
  File "/home/azureuser/hms-enterprise-grade/backend/accounting/tests.py", line 13, in <module>
    from .models import (
  File "/home/azureuser/hms-enterprise-grade/backend/accounting/models.py", line 56, in <module>
    class Currency(TenantModel):
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 140, in __new__
    raise RuntimeError(
RuntimeError: Model class backend.accounting.models.Currency doesn't declare an explicit app_label and isn't in an application in INSTALLED_APPS.


======================================================================
ERROR: test_slots (backend.appointments.tests.AvailableSlotsTest.test_slots)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/azureuser/hms-enterprise-grade/backend/appointments/tests.py", line 20, in setUp
    role=UserRole.DOCTOR,
         ^^^^^^^^^^^^^^^
AttributeError: type object 'UserRole' has no attribute 'DOCTOR'

======================================================================
FAIL: test_low_stock (backend.pharmacy.tests.LowStockTest.test_low_stock)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/azureuser/hms-enterprise-grade/backend/pharmacy/tests.py", line 31, in test_low_stock
    self.assertEqual(res.status_code, 200)
AssertionError: 403 != 200

----------------------------------------------------------------------
Ran 3 tests in 0.085s

FAILED (failures=1, errors=2)
Destroying test database for alias 'default' ('file:memorydb_default?mode=memory&cache=shared')...
