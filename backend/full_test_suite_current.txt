Creating test database for alias 'default' ('file:memorydb_default?mode=memory&cache=shared')...
Found 12 test(s).
Operations to perform:
  Synchronize unmigrated apps: corsheaders, django_filters, django_prometheus, drf_spectacular, messages, rest_framework, rest_framework_simplejwt, staticfiles
  Apply all migrations: accounting, admin, appointments, auth, billing, contenttypes, core, ehr, facilities, feedback, hospitals, hr, lab, patients, pharmacy, sessions, users
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
Running migrations:
  Applying hospitals.0001_initial... OK
  Applying contenttypes.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0001_initial... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying auth.0012_alter_user_first_name_max_length... OK
  Applying users.0001_initial... OK
  Applying patients.0001_initial... OK
  Applying patients.0002_alter_patient_email_alter_patient_phone... OK
  Applying patients.0003_emergencycontact_insuranceinformation_patientalert_and_more... OK
  Applying patients.0004_alter_patient_medical_record_number... OK
  Applying hospitals.0002_plan_hospitalplan... OK
  Applying appointments.0001_initial... OK
  Applying billing.0001_initial... OK
  Applying billing.0002_servicecatalog... OK
  Applying billing.0003_bill_discount_cents_bill_net_cents_and_more... OK
  Applying billing.0004_departmentbudget... OK
  Applying billing.0005_indexes... OK
  Applying billing.0006_remove_bill_bill_status_idx_and_more... OK
  Applying accounting.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying appointments.0002_appointmenthistory_appointmentreminder_and_more... OK
  Applying appointments.0003_alter_appointment_appointment_number... OK
  Applying core.0001_initial... OK
  Applying ehr.0001_initial... OK
  Applying ehr.0002_encounterattachment... OK
  Applying ehr.0003_allergy_assessment_clinicalnote_planofcare_and_more... OK
  Applying ehr.0004_alter_encounter_encounter_number... OK
  Applying facilities.0001_initial... OK
  Applying feedback.0001_initial... OK
  Applying hr.0001_initial... OK
  Applying lab.0001_initial... OK
  Applying pharmacy.0001_initial... OK
  Applying sessions.0001_initial... OK
  Applying users.0002_department_usercredential_userloginhistory_and_more... OK
System check identified no issues (0 silenced).
test_account_balance_calculation (accounting.tests.ChartOfAccountsTest.test_account_balance_calculation)
Test account balance calculation ... ok
test_currency_creation (accounting.tests.CurrencyModelTest.test_currency_creation)
Test basic currency creation ... ok
test_straight_line_depreciation (accounting.tests.DepreciationTest.test_straight_line_depreciation)
Test straight line depreciation calculation ... ok
test_journal_entry_creation (accounting.tests.DoubleEntryBookkeepingTest.test_journal_entry_creation)
Test creation of journal entries ... ok
test_expense_creation (accounting.tests.ExpenseTest.test_expense_creation)
Test expense creation and number generation ... ok
test_invoice_calculation (accounting.tests.InvoiceTest.test_invoice_calculation)
Test invoice total calculations ... ok
test_invoice_number_generation (accounting.tests.InvoiceTest.test_invoice_number_generation)
Test automatic invoice number generation ... ok
test_payment_updates_invoice (accounting.tests.PaymentTest.test_payment_updates_invoice)
Test that payment updates invoice status ... ok
test_payroll_calculations (accounting.tests.PayrollTest.test_payroll_calculations)
Test payroll calculations ... ok
test_trial_balance_generation (accounting.tests.ReportGenerationTest.test_trial_balance_generation)
Test trial balance report generation ... ok
test_slots (appointments.tests.AvailableSlotsTest.test_slots) ... ERROR
test_low_stock (pharmacy.tests.LowStockTest.test_low_stock) ... ok

======================================================================
ERROR: test_slots (appointments.tests.AvailableSlotsTest.test_slots)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/azureuser/hms-enterprise-grade/backend/appointments/tests.py", line 22, in setUp
    self.patient = Patient.objects.create(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 658, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/azureuser/hms-enterprise-grade/backend/patients/models.py", line 297, in save
    super().save(*args, **kwargs)
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 814, in save
    self.save_base(
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 892, in save_base
    post_save.send(
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/dispatch/dispatcher.py", line 177, in send
    (receiver, receiver(signal=self, sender=sender, **named))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/core/signals.py", line 58, in on_save
    log_action(instance, "CREATE" if created else "UPDATE")
  File "/home/azureuser/hms-enterprise-grade/backend/core/signals.py", line 38, in log_action
    AuditLog.objects.create(
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 658, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 814, in save
    self.save_base(
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 877, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1020, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1061, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1805, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1821, in execute_sql
    for sql, params in self.as_sql():
                       ^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1747, in as_sql
    self.prepare_value(field, self.pre_save_val(field, obj))
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1686, in prepare_value
    return field.get_db_prep_save(value, connection=self.connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/fields/json.py", line 136, in get_db_prep_save
    return self.get_db_prep_value(value, connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/models/fields/json.py", line 131, in get_db_prep_value
    return connection.ops.adapt_json_value(value, self.encoder)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/hms-enterprise-grade/backend/venv/lib/python3.12/site-packages/django/db/backends/base/operations.py", line 584, in adapt_json_value
    return json.dumps(value, cls=encoder)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type date is not JSON serializable

----------------------------------------------------------------------
Ran 12 tests in 0.755s

FAILED (errors=1)
Destroying test database for alias 'default' ('file:memorydb_default?mode=memory&cache=shared')...
